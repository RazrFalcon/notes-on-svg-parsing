<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Isolated groups - Notes on SVG parsing</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="the-root-of-the-problem.html"><strong aria-hidden="true">2.</strong> The root of the problem</a></li><li class="chapter-item expanded "><a href="relative-units.html"><strong aria-hidden="true">3.</strong> Relative units</a></li><li class="chapter-item expanded "><a href="rx-ry.html"><strong aria-hidden="true">4.</strong> rx/ry attributes resolving</a></li><li class="chapter-item expanded "><a href="length-parsing.html"><strong aria-hidden="true">5.</strong> Length parsing</a></li><li class="chapter-item expanded "><a href="inheritance.html"><strong aria-hidden="true">6.</strong> Attributes inheritance</a></li><li class="chapter-item expanded "><a href="path-data.html"><strong aria-hidden="true">7.</strong> Path data</a></li><li class="chapter-item expanded "><a href="isolated-groups.html" class="active"><strong aria-hidden="true">8.</strong> Isolated groups</a></li><li class="chapter-item expanded "><a href="gradients-resolving.html"><strong aria-hidden="true">9.</strong> Gradients resolving</a></li><li class="chapter-item expanded "><a href="recursive.html"><strong aria-hidden="true">10.</strong> Recursive references</a></li><li class="chapter-item expanded "><a href="empty-groups.html"><strong aria-hidden="true">11.</strong> Renderable empty groups</a></li><li class="chapter-item expanded "><a href="zero-length-paths.html"><strong aria-hidden="true">12.</strong> Zero-length paths</a></li><li class="chapter-item expanded "><a href="filter-transform.html"><strong aria-hidden="true">13.</strong> Filter transform</a></li><li class="chapter-item expanded "><a href="auto-size.html"><strong aria-hidden="true">14.</strong> Automatic document size</a></li><li class="chapter-item expanded "><a href="stroke-fallback.html"><strong aria-hidden="true">15.</strong> Stroke paint fallback</a></li><li class="chapter-item expanded "><a href="svg2-presentation.html"><strong aria-hidden="true">16.</strong> Presentation attributes in SVG 2</a></li><li class="chapter-item expanded "><a href="text/index.html"><strong aria-hidden="true">17.</strong> Text</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="text/character.html"><strong aria-hidden="true">17.1.</strong> A character</a></li><li class="chapter-item expanded "><a href="text/chunks.html"><strong aria-hidden="true">17.2.</strong> Text chunks</a></li><li class="chapter-item expanded "><a href="text/whitespaces.html"><strong aria-hidden="true">17.3.</strong> Whitespaces handling</a></li><li class="chapter-item expanded "><a href="text/bbox.html"><strong aria-hidden="true">17.4.</strong> Bounding box</a></li><li class="chapter-item expanded "><a href="text/language.html"><strong aria-hidden="true">17.5.</strong> Language</a></li><li class="chapter-item expanded "><a href="text/letter-spacing.html"><strong aria-hidden="true">17.6.</strong> letter-spacing</a></li><li class="chapter-item expanded "><a href="text/text-decoration.html"><strong aria-hidden="true">17.7.</strong> text-decoration</a></li><li class="chapter-item expanded "><a href="text/text-anchor.html"><strong aria-hidden="true">17.8.</strong> text-anchor</a></li><li class="chapter-item expanded "><a href="text/fill-rule.html"><strong aria-hidden="true">17.9.</strong> fill-rule</a></li></ol></li><li class="chapter-item expanded "><a href="use/index.html"><strong aria-hidden="true">18.</strong> The use element</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="use/use-to-symbol.html"><strong aria-hidden="true">18.1.</strong> use to symbol</a></li><li class="chapter-item expanded "><a href="use/use-to-svg-size-resolving.html"><strong aria-hidden="true">18.2.</strong> use to svg size resolving</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Notes on SVG parsing</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="isolated-groups"><a class="header" href="#isolated-groups">Isolated groups</a></h1>
<p>Most people are familiar with the concept of layers from image editing applications
like Photoshop. Where each shape, image and text are represented as individual layers
and each of those layers can be arbitrarily grouped.<br>
It's a pretty simple and intuitive idea. We essentially have a stack of images
that are blended together to produce the final image.<br>
And while SVG's XML structure may look like a tree of layers - it's not.</p>
<p>Not only we do not render each SVG element into a dedicated image/layer -
unless you have a powerful GPU and infinite RAM -
we do not have layers to begin with.<br>
When rendering SVG, we simply render each element directly to the main canvas
without creating individual images/layers. Except for <em>isolated groups</em>.</p>
<p>What is an <em>isolated group</em>? This is a very good and a very complicated question.<br>
And first we have to understand what is an SVG group.</p>
<p>An SVG group, aka the <code>&lt;g/&gt;</code> element, is technically just a syntax sugar.
It allows us to visually group elements and/or propagate common properties.
Meaning that:</p>
<pre><code class="language-xml">&lt;g fill=&quot;green&quot;&gt;
    &lt;rect/&gt;
    &lt;rect/&gt;
&lt;/g&gt;
</code></pre>
<p>is semantically identical to:</p>
<pre><code class="language-xml">&lt;rect fill=&quot;green&quot;/&gt;
&lt;rect fill=&quot;green&quot;/&gt;
</code></pre>
<p>And for our renderer such a group is <a href="https://en.wikipedia.org/wiki/NOP_(code)">no-op</a>.
We could skip it and simply render its children.</p>
<p>On the other hand, clipping, masking, filters and opacity can be set only on groups.
Yes, the ability to set the <code>opacity</code> attribute on other elements is just a syntax sugar.
Meaning that:</p>
<pre><code class="language-xml">&lt;rect opacity=&quot;0.5&quot;/&gt;
</code></pre>
<p>is technically:</p>
<pre><code class="language-xml">&lt;g opacity=&quot;0.5&quot;&gt;
    &lt;rect/&gt;
&lt;/g&gt;
</code></pre>
<p>And this time our renderer would create a temporary image, will draw a rectangle on it
and then blend that image to the main canvas.</p>
<p>A group that requires an image allocation is called <em>isolated</em>.
It can be defined indirectly, by setting non-default
<code>clip-path</code>, <code>mask</code>, <code>filter</code> and/or <code>opacity</code> attributes.
Or directly, since SVG 2, by setting <code>style=&quot;isolation:isolate&quot;</code>.</p>
<p>How bad can it be? Let's try to render a group with three circles and opacity:</p>
<pre><code class="language-xml">&lt;g opacity=&quot;0.5&quot;&gt;
    &lt;circle id=&quot;circle1&quot; cx=&quot;100&quot; cy=&quot;70&quot; r=&quot;50&quot; fill=&quot;#f00&quot;/&gt;
    &lt;circle id=&quot;circle2&quot; cx=&quot;70&quot; cy=&quot;110&quot; r=&quot;50&quot; fill=&quot;#0f0&quot;/&gt;
    &lt;circle id=&quot;circle3&quot; cx=&quot;130&quot; cy=&quot;110&quot; r=&quot;50&quot; fill=&quot;#00f&quot;/&gt;
&lt;/g&gt;
</code></pre>
<p align="center">
<img src="images/group-opacity-1.png" width="200"/>
</p>
<p>If we ignore the group isolation and simply apply opacity to each circle we would get:</p>
<p align="center">
<img src="images/group-opacity-2.png" width="200"/>
</p>
<p>Funnily enough, this is exactly what QtSvg does. It doesn't support isolation.
Probably for performance reasons.</p>
<br>
<p>You can find more details in the <a href="https://www.w3.org/TR/SVG2/render.html">spec</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="path-data.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="gradients-resolving.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="path-data.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="gradients-resolving.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
